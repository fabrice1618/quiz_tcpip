{% extends "base.html" %}

{% block extra_css %}
<link href="{{ url_for('reseau.static', filename='css/quiz.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<h3 class="mb-3">Exercice 1 — Adressage réseau</h3>

<div class="card mb-4">
    <div class="card-body">
        <p class="text-muted mb-2">Topologie : 5 machines connectées à un <strong>switch unique</strong>.</p>
        <div class="text-center my-3">
            <svg viewBox="0 0 700 260" class="topo-svg" xmlns="http://www.w3.org/2000/svg">
                <!-- Switch -->
                <rect x="300" y="10" width="60" height="50" rx="6" fill="#fff" stroke="#2c3e50" stroke-width="2"/>
                <line x1="312" y1="25" x2="332" y2="25" stroke="#2c3e50" stroke-width="3" marker-end="url(#arr)"/>
                <line x1="332" y1="25" x2="312" y2="25" stroke="#2c3e50" stroke-width="3" marker-end="url(#arr)"/>
                <line x1="312" y1="40" x2="332" y2="40" stroke="#2c3e50" stroke-width="3" marker-end="url(#arr)"/>
                <line x1="332" y1="40" x2="312" y2="40" stroke="#2c3e50" stroke-width="3" marker-end="url(#arr)"/>
                <text x="365" y="42" font-size="15" font-weight="bold" fill="#2c3e50">SWITCH</text>
                <defs><marker id="arr" viewBox="0 0 6 6" refX="5" refY="3" markerWidth="5" markerHeight="5" orient="auto"><path d="M0,0 L6,3 L0,6 Z" fill="#2c3e50"/></marker></defs>
                <!-- Lignes switch → machines -->
                <line x1="330" y1="60" x2="70"  y2="150" stroke="#444" stroke-width="1.5"/>
                <line x1="330" y1="60" x2="210" y2="150" stroke="#444" stroke-width="1.5"/>
                <line x1="330" y1="60" x2="350" y2="150" stroke="#444" stroke-width="1.5"/>
                <line x1="330" y1="60" x2="490" y2="150" stroke="#444" stroke-width="1.5"/>
                <line x1="330" y1="60" x2="630" y2="150" stroke="#444" stroke-width="1.5"/>
                <!-- Ordinateur 1 -->
                <rect x="40" y="155" width="56" height="38" rx="3" fill="#2980b9" stroke="#1a5276" stroke-width="1.5"/>
                <rect x="36" y="193" width="64" height="5" rx="2" fill="#1a5276"/>
                <rect x="56" y="198" width="24" height="8" rx="1" fill="#aaa"/>
                <text x="68" y="245" text-anchor="middle" font-size="12" fill="#333">Ordinateur 1</text>
                <!-- Ordinateur 2 -->
                <rect x="180" y="155" width="56" height="38" rx="3" fill="#2980b9" stroke="#1a5276" stroke-width="1.5"/>
                <rect x="176" y="193" width="64" height="5" rx="2" fill="#1a5276"/>
                <rect x="196" y="198" width="24" height="8" rx="1" fill="#aaa"/>
                <text x="208" y="245" text-anchor="middle" font-size="12" fill="#333">Ordinateur 2</text>
                <!-- Ordinateur 3 -->
                <rect x="320" y="155" width="56" height="38" rx="3" fill="#2980b9" stroke="#1a5276" stroke-width="1.5"/>
                <rect x="316" y="193" width="64" height="5" rx="2" fill="#1a5276"/>
                <rect x="336" y="198" width="24" height="8" rx="1" fill="#aaa"/>
                <text x="348" y="245" text-anchor="middle" font-size="12" fill="#333">Ordinateur 3</text>
                <!-- Rectifieuse 1 -->
                <path d="M460,190 L520,190 L510,165 L470,165 Z" fill="#ddd" stroke="#555" stroke-width="1.5"/>
                <circle cx="482" cy="178" r="5" fill="none" stroke="#555" stroke-width="1.5"/>
                <circle cx="498" cy="178" r="5" fill="none" stroke="#555" stroke-width="1.5"/>
                <rect x="465" y="191" width="50" height="5" rx="1" fill="#999"/>
                <text x="490" y="245" text-anchor="middle" font-size="12" fill="#333">Rectifieuse 1</text>
                <!-- Fraiseuse 1 -->
                <path d="M600,190 L660,190 L650,165 L610,165 Z" fill="#ddd" stroke="#555" stroke-width="1.5"/>
                <line x1="630" y1="170" x2="630" y2="186" stroke="#555" stroke-width="1.5"/>
                <line x1="622" y1="178" x2="638" y2="178" stroke="#555" stroke-width="1.5"/>
                <rect x="605" y="191" width="50" height="5" rx="1" fill="#999"/>
                <text x="630" y="245" text-anchor="middle" font-size="12" fill="#333">Fraiseuse 1</text>
            </svg>
        </div>
    </div>
</div>

<form method="POST" action="{{ url_for('.exercice', n=1) }}">

    {# === 1.1 — Adresses réseau === #}
    <h5 class="mb-3">1.1 — Pour chaque machine, calculer l'adresse réseau</h5>
    <div class="table-responsive mb-4">
        <table class="table table-striped table-bordered table-quiz">
            <thead>
                <tr>
                    <th>Identification</th>
                    <th>Adresse IP</th>
                    <th>Masque réseau</th>
                    <th>Adresse réseau</th>
                </tr>
            </thead>
            <tbody>
                {% for m in machines %}
                <tr>
                    <td class="given">{{ m.nom }}</td>
                    <td class="given font-monospace">{{ m.ip }}</td>
                    <td class="given font-monospace">{{ m.masque }}</td>
                    <td>
                        <input type="text" name="ex1_reseau_{{ m.id }}" class="input-ip"
                               value="{{ reponses.get('ex1_reseau_' ~ m.id, '') }}">
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {# === 1.2 — Communication === #}
    <h5 class="mb-3">1.2 — Pour chaque machine, cocher les machines pouvant communiquer avec elle</h5>
    <div class="table-responsive mb-4">
        <table class="table table-striped table-bordered table-quiz">
            <thead>
                <tr>
                    <th>Identification</th>
                    {% for m in machines %}
                    <th class="text-center comm-header">{{ m.nom | replace("Ordinateur ", "Ordi ") | replace("Rectifieuse ", "Rect ") | replace("Fraiseuse ", "Frais ") }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for m in machines %}
                <tr>
                    <td class="given">{{ m.nom }}</td>
                    {% for other in machines %}
                    <td class="text-center">
                        {% if m.id == other.id %}
                        <span class="text-muted">—</span>
                        {% else %}
                        <input type="checkbox" class="form-check-input"
                               name="ex1_comm_{{ m.id }}_{{ other.id }}"
                               {% if reponses.get('ex1_comm_' ~ m.id ~ '_' ~ other.id) == 'on' %}checked{% endif %}>
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {# === 1.3 — Diagnostic === #}
    <h5 class="mb-3">1.3 — Outil de diagnostique</h5>
    <div class="card mb-4">
        <div class="card-body">
            <p>En étant connecté à l'<strong>Ordinateur 1</strong>, expliquer comment vérifier si la communication fonctionne avec la <strong>Fraiseuse 1</strong> ?</p>
            <textarea name="ex1_diagnostic" class="form-control" rows="3"
                      placeholder="Votre réponse...">{{ reponses.get('ex1_diagnostic', '') }}</textarea>
        </div>
    </div>

    <div class="nav-buttons">
        <div></div>
        <button type="submit" class="btn btn-primary">Suivant →</button>
    </div>
</form>
{% endblock %}
