{% extends "base.html" %}

{% block content %}
<h3 class="mb-3">Exercice 2 — Routage inter-réseaux</h3>

<div class="card mb-4">
    <div class="card-body">
        <p class="text-muted mb-2">Topologie :</p>
        <ul class="text-muted small mb-0">
            <li>Le <strong>switch 1</strong> est connecté à l'<strong>interface LAN</strong> du routeur.</li>
            <li>Les <strong>ordinateurs 1 et 2</strong> sont connectés au switch 1.</li>
            <li>Le <strong>switch 2</strong> est connecté à l'<strong>interface WAN</strong> du routeur.</li>
            <li>Les <strong>ordinateurs 3 et 4</strong> sont connectés au switch 2.</li>
        </ul>
        <div class="text-center my-3">
            <svg viewBox="0 0 800 340" class="topo-svg-routing" xmlns="http://www.w3.org/2000/svg">
                <!-- Routeur (haut centre) -->
                <rect x="330" y="10" width="120" height="30" rx="10" fill="#f5f5f0" stroke="#999" stroke-width="1.5"/>
                <rect x="345" y="16" width="12" height="4" rx="1" fill="#5ba" opacity="0.6"/>
                <rect x="362" y="16" width="12" height="4" rx="1" fill="#5ba" opacity="0.6"/>
                <rect x="345" y="24" width="12" height="4" rx="1" fill="#5ba" opacity="0.6"/>
                <rect x="362" y="24" width="12" height="4" rx="1" fill="#5ba" opacity="0.6"/>
                <text x="390" y="55" font-size="11" fill="#333" font-weight="bold">routeur</text>
                <text x="390" y="67" font-size="10" fill="#555">WAN: 192.168.0.254</text>
                <text x="390" y="79" font-size="10" fill="#555">LAN: -</text>
                <!-- Labels LAN / WAN sur les liens -->
                <text x="260" y="65" font-size="10" fill="#e74c3c" font-weight="bold">LAN</text>
                <text x="520" y="65" font-size="10" fill="#e74c3c" font-weight="bold">WAN</text>
                <!-- Lignes routeur → switches (rouge) -->
                <line x1="370" y1="40" x2="190" y2="105" stroke="#e74c3c" stroke-width="2"/>
                <line x1="430" y1="40" x2="610" y2="105" stroke="#e74c3c" stroke-width="2"/>
                <!-- Switch 1 (gauche) -->
                <rect x="150" y="100" width="80" height="24" rx="4" fill="#2980b9" stroke="#1a5276" stroke-width="1.5"/>
                <rect x="160" y="107" width="8" height="3" rx="1" fill="#fff" opacity="0.5"/>
                <rect x="172" y="107" width="8" height="3" rx="1" fill="#fff" opacity="0.5"/>
                <rect x="184" y="107" width="8" height="3" rx="1" fill="#fff" opacity="0.5"/>
                <rect x="196" y="107" width="8" height="3" rx="1" fill="#fff" opacity="0.5"/>
                <text x="190" y="140" text-anchor="middle" font-size="11" fill="#333">switch 1</text>
                <!-- Switch 2 (droite) -->
                <rect x="570" y="100" width="80" height="24" rx="4" fill="#2980b9" stroke="#1a5276" stroke-width="1.5"/>
                <rect x="580" y="107" width="8" height="3" rx="1" fill="#fff" opacity="0.5"/>
                <rect x="592" y="107" width="8" height="3" rx="1" fill="#fff" opacity="0.5"/>
                <rect x="604" y="107" width="8" height="3" rx="1" fill="#fff" opacity="0.5"/>
                <rect x="616" y="107" width="8" height="3" rx="1" fill="#fff" opacity="0.5"/>
                <text x="610" y="140" text-anchor="middle" font-size="11" fill="#333">switch 2</text>
                <!-- Lignes switch 1 → ordis 1 & 2 (rouge) -->
                <line x1="170" y1="124" x2="100" y2="210" stroke="#e74c3c" stroke-width="2"/>
                <line x1="210" y1="124" x2="270" y2="210" stroke="#e74c3c" stroke-width="2"/>
                <!-- Lignes switch 2 → ordis 3 & 4 (rouge) -->
                <line x1="590" y1="124" x2="520" y2="210" stroke="#e74c3c" stroke-width="2"/>
                <line x1="630" y1="124" x2="700" y2="210" stroke="#e74c3c" stroke-width="2"/>
                <!-- Ordinateur 1 -->
                <rect x="60" y="215" width="56" height="38" rx="3" fill="#2980b9" stroke="#1a5276" stroke-width="1.5"/>
                <rect x="56" y="253" width="64" height="5" rx="2" fill="#1a5276"/>
                <rect x="76" y="258" width="24" height="8" rx="1" fill="#aaa"/>
                <text x="88" y="282" text-anchor="middle" font-size="11" fill="#333" font-weight="bold">Ordinateur 1</text>
                <text x="88" y="294" text-anchor="middle" font-size="9" fill="#555">192.168.0.1</text>
                <!-- Ordinateur 2 -->
                <rect x="240" y="215" width="56" height="38" rx="3" fill="#2980b9" stroke="#1a5276" stroke-width="1.5"/>
                <rect x="236" y="253" width="64" height="5" rx="2" fill="#1a5276"/>
                <rect x="256" y="258" width="24" height="8" rx="1" fill="#aaa"/>
                <text x="268" y="282" text-anchor="middle" font-size="11" fill="#333" font-weight="bold">Ordinateur 2</text>
                <text x="268" y="294" text-anchor="middle" font-size="9" fill="#555">-</text>
                <!-- Ordinateur 3 -->
                <rect x="490" y="215" width="56" height="38" rx="3" fill="#2980b9" stroke="#1a5276" stroke-width="1.5"/>
                <rect x="486" y="253" width="64" height="5" rx="2" fill="#1a5276"/>
                <rect x="506" y="258" width="24" height="8" rx="1" fill="#aaa"/>
                <text x="518" y="282" text-anchor="middle" font-size="11" fill="#333" font-weight="bold">Ordinateur 3</text>
                <text x="518" y="294" text-anchor="middle" font-size="9" fill="#555">-</text>
                <!-- Ordinateur 4 -->
                <rect x="670" y="215" width="56" height="38" rx="3" fill="#2980b9" stroke="#1a5276" stroke-width="1.5"/>
                <rect x="666" y="253" width="64" height="5" rx="2" fill="#1a5276"/>
                <rect x="686" y="258" width="24" height="8" rx="1" fill="#aaa"/>
                <text x="698" y="282" text-anchor="middle" font-size="11" fill="#333" font-weight="bold">Ordinateur 4</text>
                <text x="698" y="294" text-anchor="middle" font-size="9" fill="#555">-</text>
            </svg>
        </div>
    </div>
</div>

<p class="text-muted">Complétez le tableau ci-dessous. Les valeurs sur fond gris sont données.</p>

<form method="POST" action="{{ url_for('exercice', n=2) }}">
    <div class="table-responsive mb-4">
        <table class="table table-striped table-bordered table-quiz">
            <thead>
                <tr>
                    <th>Identification</th>
                    <th>Adresse IP</th>
                    <th>Masque réseau</th>
                </tr>
            </thead>
            <tbody>
                {% for dev in devices %}
                <tr>
                    <td class="given">{{ dev.nom }}</td>

                    {% if dev.get('given') %}
                    {# Valeur fournie #}
                    {% if dev.id == 'routeur_wan' %}
                    <td class="given font-monospace">{{ given.routeur_wan.ip }}</td>
                    <td class="given font-monospace">{{ given.routeur_wan.masque }}</td>
                    {% elif dev.id == 'ex2_ordi1' %}
                    <td class="given font-monospace">{{ given.ordi1.ip }}</td>
                    <td class="given font-monospace">{{ given.ordi1.masque }}</td>
                    {% endif %}
                    {% else %}
                    {# Champ à remplir #}
                    <td>
                        <input type="text" name="ex2_ip_{{ dev.id }}" class="input-ip"
                               value="{{ reponses.get('ex2_ip_' ~ dev.id, '') }}"
                               >
                    </td>
                    <td>
                        <input type="text" name="ex2_masque_{{ dev.id }}" class="input-ip"
                               value="{{ reponses.get('ex2_masque_' ~ dev.id, '') }}"
                               >
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="nav-buttons">
        <a href="{{ url_for('exercice', n=1) }}" class="btn btn-outline-secondary">← Précédent</a>
        <button type="submit" class="btn btn-success">Valider le test</button>
    </div>
</form>
{% endblock %}
